<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Construction Schedule Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Visualization & Content Choices:
    1. Report Info: Construction Schedule Markdown. Goal: Visualize project timeline. Viz: Horizontal Bar Chart (Gantt-like) using Chart.js. Interaction: Tooltips on hover, click to select task. Justification: Standard for project schedules, offering clear visual representation of task durations and overlaps, with selection for further detail. Library: Chart.js.
    2. Report Info: Task Names. Goal: Provide detailed explanation of tasks. Viz: Text display generated by LLM. Interaction: Button click to trigger LLM call after task selection. Justification: Enhances understanding of specific tasks by providing context beyond the schedule, leveraging generative AI for dynamic content. Library: Gemini API (gemini-2.0-flash).
    NO SVG/Mermaid. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #1e293b; /* text-slate-800 */
        }
        .chart-container-wrapper {
            position: relative;
            width: 100%;
            max-width: 80rem; /* max-w-7xl */
            margin-left: auto;
            margin-right: auto;
            padding: 1rem; /* p-4 */
        }
        .chart-container {
            position: relative;
            height: 700px; /* Base height, adjust with media queries or use Tailwind for responsive heights */
            max-height: 1000px;
            width: 100%;
        }
        @media (min-width: 640px) { /* sm */
            .chart-container {
                height: 800px;
            }
        }
        @media (min-width: 1024px) { /* lg */
            .chart-container {
                height: 900px;
            }
        }

        .chart-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .chart-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .chart-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .chart-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .tooltip-custom {
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.875rem;
            pointer-events: none;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-slate-700 text-white p-6 shadow-md">
        <div class="container mx-auto max-w-7xl flex flex-col items-center text-center">
            <h1 class="text-2xl md:text-3xl font-bold mb-2">Kitchen Remodel & Roof Alteration - Construction Schedule</h1>
            <p class="text-sm md:text-base">Project Address: 12 Indian Trail Court, Novato, Ca, 94947</p>
            <p class="text-sm md:text-base">Builder: 2K Builders</p>
            <p class="text-sm md:text-base">Project Start Date: May 22, 2025 (Demolition in Progress)</p>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8 flex-grow w-full">
        <div class="bg-white shadow-xl rounded-lg p-4 sm:p-6 mb-8">
            <p class="text-slate-700 mb-6 text-sm md:text-base leading-relaxed">
                This interactive application visualizes the typical construction schedule for the Kitchen Remodel and Roof Alteration project. The Gantt chart below displays each phase and task, along with their estimated durations in weeks. Hover over any task bar to see more details, including the specific start and end weeks and the associated project phase. This tool is designed to provide a clear overview of the project timeline and help in understanding the sequence and dependencies of various construction activities.
            </p>

            <div class="chart-container-wrapper">
                <div class="chart-container">
                    <canvas id="ganttChart"></canvas>
                </div>
            </div>
        </div>

        <div class="bg-white shadow-xl rounded-lg p-4 sm:p-6">
            <h2 class="text-xl md:text-2xl font-semibold text-slate-800 mb-4">Task Insight Generator</h2>
            <p class="text-slate-700 mb-4 text-sm md:text-base leading-relaxed">
                Click on any task bar in the Gantt chart above to select it. Once a task is selected, click the button below to generate a detailed explanation of what that task typically involves in a construction project, powered by the Gemini API.
            </p>

            <div class="flex flex-col sm:flex-row items-center gap-4 mb-6">
                <div class="flex-grow w-full sm:w-auto">
                    <span class="font-medium text-slate-600">Selected Task:</span>
                    <span id="selectedTaskName" class="ml-2 text-slate-800 font-semibold italic">None</span>
                </div>
                <button id="generateInsightBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2" disabled>
                    Generate Task Insight âœ¨
                    <div id="loadingSpinner" class="loading-spinner"></div>
                </button>
            </div>

            <div class="bg-slate-100 p-4 rounded-md border border-slate-200 min-h-[150px]">
                <p id="insightOutput" class="text-slate-700 text-sm md:text-base leading-relaxed">
                    Your generated task insight will appear here.
                </p>
            </div>
        </div>
    </main>

    <footer class="bg-slate-700 text-white text-center p-4 mt-8">
        <p class="text-sm">&copy; 2024 Project Schedule Visualization. All rights reserved.</p>
    </footer>

    <script>
        const markdownData = `
| Phase/Task                          | Week 1 | Week 2 | Week 3 | Week 4 | Week 5 | Week 6 | Week 7 | Week 8 | Week 9 | Week 10 | Week 11 | Week 12 | Week 13 | Week 14 | Week 15 | Week 16 | Week 17 | Week 18 | Week 19 | Week 20 |
| :---------------------------------- | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: |
| **1. Pre-Construction & Permitting** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Permit Application & Approval       |   X    |   X    |   X    |   X    |   X    |   X    |   X    |   X    |        |         |         |         |         |         |         |         |         |         |         |         |
| Contractor Selection & Mobilization |        |        |        |        |        |        |        |   X    |   X    |         |         |         |         |         |         |         |         |         |         |         |
| **2. Demolition** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Site Protection & Prep              |        |        |        |        |        |        |        |        |   X    |         |         |         |         |         |         |         |         |         |         |         |
| Interior Demolition                 |        |        |        |        |        |        |        |        |        |    X    |         |         |         |         |         |         |         |         |         |         |
| Roof Demolition                     |        |        |        |        |        |        |        |        |        |    X    |         |         |         |         |         |         |         |         |         |         |
| Debris Removal                      |        |        |        |        |        |        |        |        |        |         |    X    |         |         |         |         |         |         |         |         |         |
| **3. Structural Framing** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Foundation/Slab Prep (Deck)         |        |        |        |        |        |        |        |        |        |         |    X    |         |         |         |         |         |         |         |         |         |
| Wall Framing (New Kitchen, etc.)    |        |        |        |        |        |        |        |        |        |         |         |    X    |    X    |         |         |         |         |         |         |         |
| Roof & Dormer Framing               |        |        |        |        |        |        |        |        |        |         |         |    X    |    X    |         |         |         |         |         |         |         |
| Deck Framing                        |        |        |        |        |        |        |        |        |        |         |         |         |    X    |         |         |         |         |         |         |         |
| **4. Rough-ins & Exterior Sheathing** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Exterior Sheathing & Weather Barrier |        |        |        |        |        |        |        |        |        |         |         |         |    X    |         |         |         |         |         |         |         |
| Electrical Rough-in                 |        |        |        |        |        |        |        |        |        |         |         |         |         |    X    |    X    |         |         |         |         |         |
| Plumbing Rough-in                   |        |        |        |        |        |        |        |        |        |         |         |         |         |    X    |    X    |         |         |         |         |         |
| HVAC/Mechanical Rough-in            |        |        |        |        |        |        |        |        |        |         |         |         |         |    X    |         |         |         |         |         |         |
| **5. Rough Inspections** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Framing, MEP Inspections            |        |        |        |        |        |        |        |        |        |         |         |         |         |         |    X    |         |         |         |         |         |
| **6. Exterior Finishes** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Roofing (Reshingle, Dormers)        |        |        |        |        |        |        |        |        |        |         |         |         |         |         |    X    |    X    |         |         |         |         |
| Exterior Siding/Finishes            |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |    X    |         |         |         |         |
| Window & Door Installation          |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |    X    |         |         |         |         |
| **7. Interior Finishes - Drywall & Paint** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Insulation                          |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |    X    |         |         |         |         |
| Drywall Installation                |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |    X    |    X    |         |         |
| Interior Painting                   |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |    X    |    X    |         |
| **8. Interior Finishes - Flooring, Cabinets, Fixtures** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Flooring Installation               |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |    X    |         |
| Cabinet Installation                |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |    X    |    X    |
| Countertop Templating & Installation |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Trim & Interior Doors               |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Electrical Finish (Fixtures)        |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Plumbing Finish (Fixtures)          |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Appliance Installation              |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| **9. Final Touches & Closeout** |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |         |
| Punch List & Touch-ups              |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Final Inspections                   |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
| Cleaning & Project Closeout         |        |        |        |        |        |        |        |        |        |         |         |         |         |         |         |         |         |         |         |    X    |
`;

        const phaseColors = {
            "1. Pre-Construction & Permitting": 'rgba(239, 68, 68, 0.7)',      // Red-500
            "2. Demolition": 'rgba(59, 130, 246, 0.7)',        // Blue-500
            "3. Structural Framing": 'rgba(234, 179, 8, 0.7)',     // Yellow-500
            "4. Rough-ins & Exterior Sheathing": 'rgba(16, 185, 129, 0.7)', // Emerald-500
            "5. Rough Inspections": 'rgba(139, 92, 246, 0.7)',     // Violet-500
            "6. Exterior Finishes": 'rgba(249, 115, 22, 0.7)',    // Orange-500
            "7. Interior Finishes - Drywall & Paint": 'rgba(34, 197, 94, 0.7)', // Green-500
            "8. Interior Finishes - Flooring, Cabinets, Fixtures": 'rgba(217, 70, 239, 0.7)', // Fuchsia-500
            "9. Final Touches & Closeout": 'rgba(20, 184, 166, 0.7)'      // Teal-500
        };

        const projectStartDate = new Date('2025-05-22'); // May 22, 2025

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        function getWeekStartDate(startWeek) {
            const daysToAdd = (startWeek - 1) * 7;
            return addDays(projectStartDate, daysToAdd);
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        const scheduleData = [];
        let currentPhase = "";
        const lines = markdownData.trim().split('\n');

        for (const line of lines) {
            if (line.startsWith('| :---') || line.trim() === '' || line.startsWith('| Phase/Task')) {
                continue;
            }

            const columns = line.split('|').map(col => col.trim());
            if (columns.length < 2) continue; 
            
            const taskOrPhaseName = columns[1];

            if (taskOrPhaseName.startsWith('**')) {
                currentPhase = taskOrPhaseName.replace(/\*\*/g, '');
            } else if (currentPhase && taskOrPhaseName) {
                let startWeek = -1;
                let endWeek = -1;
                for (let i = 2; i < columns.length -1; i++) { 
                    if (columns[i].toLowerCase().includes('x')) {
                        if (startWeek === -1) {
                            startWeek = i - 1; 
                        }
                        endWeek = i - 1;
                    }
                }
                if (startWeek !== -1) {
                    scheduleData.push({
                        phase: currentPhase,
                        task: taskOrPhaseName,
                        start: startWeek, 
                        end: endWeek,   
                        color: phaseColors[currentPhase] || 'rgba(107, 114, 128, 0.7)'
                    });
                }
            }
        }
        
        const ctx = document.getElementById('ganttChart').getContext('2d');
        const ganttChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: scheduleData.map(item => item.task),
                datasets: [{
                    label: 'Task Duration (Weeks)',
                    data: scheduleData.map(item => [item.start -1, item.end]),
                    backgroundColor: scheduleData.map(item => item.color),
                    borderColor: scheduleData.map(item => item.color.replace('0.7', '1')),
                    borderWidth: 1,
                    barPercentage: 0.7,
                    categoryPercentage: 0.8,
                    borderSkipped: false, 
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        min: 0,
                        max: 20, 
                        ticks: {
                            stepSize: 1,
                            callback: function(value) {
                                if (value >= 0 && value < 20) {
                                   const date = getWeekStartDate(value + 1);
                                   return formatDate(date);
                                }
                                return '';
                            },
                            color: '#4b5563',
                        },
                        grid: { 
                            display: true,
                            color: '#e5e7eb',
                        },
                        title: { 
                            display: true, 
                            text: 'Project Timeline (Start Date of Week)',
                            font: { size: 14, weight: '600' },
                            color: '#374151'
                        }
                    },
                    y: {
                        grid: { 
                            display: false 
                        },
                        ticks: {
                            autoSkip: false,
                            color: '#4b5563', 
                            font: { size: 11 },
                            callback: function(value) { 
                                const label = this.getLabelForValue(value);
                                const maxLength = 35;
                                if (typeof label === 'string' && label.length > maxLength) {
                                    const words = label.split(' ');
                                    const lines = [];
                                    let currentLine = '';
                                    for (const word of words) {
                                        if (currentLine.length > 0 && (currentLine + ' ' + word).length > maxLength) {
                                            lines.push(currentLine);
                                            currentLine = word;
                                        } else {
                                            if (currentLine.length > 0) currentLine += ' ';
                                            currentLine += word;
                                        }
                                    }
                                    lines.push(currentLine);
                                    return lines;
                                }
                                return label;
                            }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(0,0,0,0.85)',
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 12 },
                        padding: 10,
                        displayColors: false,
                        callbacks: {
                            title: function(tooltipItems) {
                                return scheduleData[tooltipItems[0].dataIndex].task;
                            },
                            label: function(context) {
                                const taskData = scheduleData[context.dataIndex];
                                const startActualDate = getWeekStartDate(taskData.start);
                                const endActualDate = addDays(getWeekStartDate(taskData.end), 6); // End of the end week
                                return [
                                    `Phase: ${taskData.phase}`,
                                    `Start: ${formatDate(startActualDate)}`,
                                    `End: ${formatDate(endActualDate)}`
                                ];
                            }
                        }
                    },
                    legend: {
                        display: false,
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const clickedElementIndex = elements[0].index;
                        const selectedTask = scheduleData[clickedElementIndex].task;
                        document.getElementById('selectedTaskName').textContent = selectedTask;
                        document.getElementById('generateInsightBtn').disabled = false;
                        document.getElementById('insightOutput').textContent = 'Your generated task insight will appear here.';
                    }
                }
            }
        });

        const generateInsightBtn = document.getElementById('generateInsightBtn');
        const selectedTaskNameSpan = document.getElementById('selectedTaskName');
        const insightOutputDiv = document.getElementById('insightOutput');
        const loadingSpinner = document.getElementById('loadingSpinner');

        generateInsightBtn.addEventListener('click', async () => {
            const selectedTask = selectedTaskNameSpan.textContent;
            if (selectedTask === 'None' || !selectedTask) {
                insightOutputDiv.textContent = 'Please select a task from the chart first.';
                return;
            }

            insightOutputDiv.textContent = '';
            loadingSpinner.style.display = 'block';
            generateInsightBtn.disabled = true;

            const prompt = `Provide a brief, standard description of the construction task: "${selectedTask}". Focus on what this task generally involves in a typical residential remodel project.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    insightOutputDiv.textContent = text;
                } else {
                    insightOutputDiv.textContent = 'Failed to generate insight. Please try again.';
                }
            } catch (error) {
                insightOutputDiv.textContent = `An error occurred: ${error.message}. Please check your connection or try again.`;
                console.error('Error calling Gemini API:', error);
            } finally {
                loadingSpinner.style.display = 'none';
                generateInsightBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
